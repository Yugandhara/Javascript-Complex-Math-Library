(function(root){function C(e,t,n,r){var i=this instanceof C,s=i?this:new C(e,t,n,r);if(!i)return s;s.m=typeof n=="number"?Math.abs(n):Math.sqrt(e*e+t*t);if(typeof r=="number"){s.t=n>=0?r:r+PI}else{s.t=Math.atan2(t,e)}s.t=PI-(PI*3-(PI-(PI*3-s.t)%(PI*2)))%(PI*2);s.r=e;s.i=t}var Math=root.Math;Math.sinh=function(e){return(-Math.exp(-e)+Math.exp(e))/2};Math.cosh=function(e){return(Math.exp(-e)+Math.exp(e))/2};var floor=function(e){return e>=0?e-e%1:e-(e%1+1)},round=function(e){e+=.5;return e>=0?e-e%1:e-(e%1+1)},ceil=function(e){return e>=0?e-(e%1+1):e-e%1},PI=Math.PI;C.prototype.toString=function(e){return e?this.r.toPrecision().toUpperCase()+(this.i>=0?"+":"")+this.i.toPrecision().toUpperCase()+" i":this.m.toPrecision().toUpperCase()+"*e^("+this.t.toPrecision().toUpperCase()+"*i)"};C.exp=function(e){return e.i==0?C["E"].pow(e.r):C.Polar(Math.exp(e.r),e.i)};C.Polar=function(e,t){return new C(e*Math.cos(t),e*Math.sin(t),e,t)};C.prototype.add=function(e){return C(this.r+e.r,this.i+e.i)};C.prototype.sub=function(e){return C(this.r-e.r,this.i-e.i)};C.floor=function(e){return C(floor(e.r),floor(e.i))};C.ceil=function(e){return C(ceil(e.r),ceil(e.i))};C.conj=function(e){return C(e.r,-e.i,e.m,(PI*2-e.t)%PI*2)};C.prototype.mult=function(e){return C.Polar(this.m*e.m,this.t+e.t)};C.prototype.divBy=function(e){return C.Polar(this.m/e.m,this.t-e.t)};C.square=function(e){return C(e.r*e.r-e.i*e.i,2*e.r*e.i,e.m*e.m,e.t*2)};C.cube=function(e){return C(e.r*e.r*e.r-3*e.r*e.i*e.i,3*e.r*e.r-e.i*e.i*e.i)};C.prototype.pow=function(e){if(e==2)return C.square(this);if(e==3)return C.cube(this);return C.Polar(Math.pow(this.m,e),this.t*e)};C.sqrt=function(e){return e.pow(.5)};C.cbrt=function(e){return e.pow(1/3)};C.prototype.cPow=function(e){return e.i==0?this.pow(e.r):C.Polar(Math.pow(this.m,e.r)*Math.exp(-e.i*this.t),e.i*Math.log(this.m)+e.r*this.t)};C.cos=function(e){var t=e.mult(C["I"]);return C.exp(t).add(C.exp(C.neg(t))).divBy(C["2"])};C.sin=function(e){var t=e.mult(C["I"]);return C.exp(t).sub(C.exp(C.neg(t))).divBy(C["2I"])};C.tan=function(e){var t=e.mult(C["I"]),n=C.exp(t),r=C.exp(C.neg(t));return n.sub(r).divBy(n.add(r).mult(C["I"]))};C.sec=function(e){var t=e.mult(C["I"]);return C["2"].divBy(C.exp(t).add(C.exp(C.neg(t))))};C.csc=function(e){var t=e.mult(C["I"]);return C["2I"].divBy(C.exp(t).sub(C.exp(C.neg(t))))};C.cot=function(e){var t=e.mult(C["I"]),n=C.exp(t),r=C.exp(C.neg(t));return n.add(r).mult(C["I"]).divBy(n.sub(r))};C.log=function(e){return C(Math.log(e.m),e.t+PI*2*round(-e.t/PI*2))};C.arcsin=function(e){return C["-I"].mult(C.log(C["I"].mult(e).add(C.sqrt(C["1"].sub(e.pow(2))))))};C.arccos=function(e){return C["I"].mult(C.log(e.add(C["-I"].mult(C.sqrt(C["1"].sub(e.pow(2)))))))};C.arctan=function(e){var t=C["I"];return t.mult(C.log(t.add(e).divBy(t.sub(e)))).divBy(C["2"])};C.arcsec=function(e){return C["-I"].mult(C.log(e.pow(-1).add(C.sqrt(C["1"].sub(C["I"].divBy(e.pow(2)))))))};C.arccsc=function(e){return C["-I"].mult(C.log(C["I"].divBy(e).add(C.sqrt(C["1"].sub(e.pow(-2))))))};C.arccot=function(e){var t=C["I"];return t.mult(C.log(e.sub(t).divBy(e.add(t)))).divBy(C["2"])};C.sinh=function(e){return C.exp(e).sub(C.exp(C.neg(e))).divBy(C["2"])};C.cosh=function(e){return C.exp(e).add(C.exp(C.neg(e))).divBy(C["2"])};C.tanh=function(e){var t=C.exp(e),n=C.exp(C.neg(e));return t.sub(n).divBy(t.add(n))};C.csch=function(e){return C["2"].divBy(C.exp(e).sub(C.exp(C.neg(e))))};C.sech=function(e){return C["2"].divBy(C.exp(e).add(C.exp(C.neg(e))))};C.coth=function(e){var t=C.exp(e),n=C.exp(C.neg(e));return t.add(n).divBy(t.sub(n))};C.arcsinh=function(e){return C.log(e.add(C.sqrt(e.pow(2).add(C["1"]))))};C.arccosh=function(e){return C.log(e.add(C.sqrt(e.pow(2).sub(C["1"]))))};C.arctanh=function(e){return C.log(C["1"].add(e).divBy(C["1"].sub(e))).divBy(C["2"])};C.arcsech=function(e){return C.log(C["1"].add(C.sqrt(C["1"].sub(e.pow(2)))).divBy(e))};C.arccsch=function(e){return C.log(C["1"].add(C.sqrt(C["1"].add(e.pow(2)))).divBy(e))};C.arccoth=function(e){return C.log(e.add(C["1"]).divBy(e.sub(C["1"]))).divBy(C["2"])};C.neg=function(e){return C(-e.r,-e.i,e.m,e.t+PI)};C.re=function(e){return C(e.r,0,Math.abs(e.r),e.r<0?PI:0)};C.im=function(e){return C(e.i,0,Math.abs(e.i),e.i<0?PI:0)};C.abs=function(e){return C(e.m,0,e.m,0)};C.arg=function(e){return C(e.t,0,e.t,0)};C.round=function(e){return C(round(e.r),round(e.i))};C.fPart=function(e){return C(e.r-floor(e.r),e.i-floor(e.i))};C.prototype.mod=function(e){return C(this.r%e.r,this.i%e.i)};C.min=function(){var e=Array.prototype.slice.call(arguments).map(function(e){return e.m}),t=Math.min.apply(Math,e);return arguments[e.indexOf(t)]};C.max=function(){var e=Array.prototype.slice.call(arguments).map(function(e){return e.m}),t=Math.max.apply(Math,e);return arguments[e.indexOf(t)]};C.isNaN=function(e){return isNaN(e.r)||isNaN(e.i)||isNaN(e.m)||isNaN(e.t)};C.isFinite=function(e){return isFinite(e.m)};C.parseFunction=function(str,args,skipFormat){with(this){var vars=generate(args||[]);str=str.toLowerCase();if(!skipFormat)str=formatFunction(str);var namespace=new Namespace;return(new Function(args.map(function(e){return vars[e]}).join(","),"return "+function compile(e){var t=compile,n="",r=0,i=0;while(r<e.length){if(i!=2&&e.substr(r,2)!="e^"&&e.substr(r).search(varsExp)==0){var s=e.substr(r).match(varsExp)[0],o=varsObj[s]||vars[s];if(!o)throw'"'+s+'" is not a valid variable.';n+=o;r+=s.length;i=2;continue}if(i!=2&&e.substr(r).search(funcExp)==0){var s=e.substr(r).match(funcExp)[0],u=funcObj[s],a=s=="-"?nextAddSub(e,r+s.length):s=="e^"?nextPower(e,r+s.length):endNest(e,r+s.length);if(!u){s=s.substr(0,s.length-1);if(!(varsObj[s]||vars[s]))throw'"'+s+'(" is not a valid function.';e=e.substr(0,r)+s+"*("+e.substr(r+s.length+1);continue}n+=u=="("?"":u;r+=s.length;n+=t(e.substring(r,a))+(u=="("?"":")");r=e[a]==")"?a+1:a;i=2;continue}if(i==2&&e.substr(r).search(operExp)==0){var s=e.substr(r).match(operExp)[0],f=operObj[s],l=e.substr(r+1).search(numsExp)==0&&e.substr(r+1).match(numsExp)[0],a=nextOperator(s,e,r+s.length+(l?l.length:0));if(!f)throw'"'+s+'" is not a valid operator.';n+=f;r+=s.length;n+=t(e.substring(r,a))+")";r=e[a]==")"?a+1:a;i=2;continue}if(i!=2&&e.substr(r).search(numsExp)==0){var s=e.substr(r).match(numsExp)[0],c=parseFloat(s);if(isNaN(c))throw'"'+s+'" is not a valid number.';n+="this.array["+namespace.addC(C(c,0,c,0))+"]";r+=s.length;i=2;continue}throw'Unexpected character "'+e.charAt(r)+'".'}return n}(str)+";")).bind(namespace)}};C.parseFunction=C.parseFunction.bind(function(){var e=/(?:\d[a-z\{\[\(]|[\}\]\)][a-z\d])|(?:[\{\}\[\]]| *[\+\-\*\/\^ %] *)/gi,t=/[a-z]*\(|(?:-|e\^)(?:\(|)/,n=/[a-z]+(?![a-z]*\()/,r=/[\+\-\*\/\^ %]/,i=/(?:(?:\d*\.\d+|\d+\.\d*)|\d+)(?:e(?:-|)\d+|)/,s={"cos(":"C.cos(","sin(":"C.sin(","tan(":"C.tan(","sec(":"C.sec(","csc(":"C.csc(","cot(":"C.cot(","log(":"C.log(","ln(":"C.log(","(":"(","e^":"C.exp(","e^(":"C.exp(","arccos(":"C.arccos(","arcsin(":"C.arcsin(","arctan(":"C.arctan(","arcsec(":"C.arcsec(","arccsc(":"C.arccsc(","arccot(":"C.arccot(","acos(":"C.arccos(","asin(":"C.arcsin(","atan(":"C.arctan(","asec(":"C.arcsec(","acsc(":"C.arccsc(","acot(":"C.arccot(","-":"C.neg(","-(":"C.neg(","cosh(":"C.cosh(","sinh(":"C.sinh(","tanh(":"C.tanh(","sech(":"C.sech(","csch(":"C.csch(","coth(":"C.coth(","re(":"C.re(","im(":"C.im(","abs(":"C.abs(","arg(":"C.arg(","conj(":"C.conj(","int(":"C.floor(","floor(":"C.floor(","ceil(":"C.ceil(","round(":"C.round(","fpart(":"C.fPart(","ipart(":"C.floor(","sqrt(":"C.sqrt(","cbrt(":"C.cbrt(","arccosh(":"C.arccosh(","arcsinh(":"C.arcsinh(","arctanh(":"C.arctanh(","arcsech(":"C.arcsech(","arccsch(":"C.arccsch(","arccoth(":"C.arccoth(","arcosh(":"C.arccosh(","arsinh(":"C.arcsinh(","artanh(":"C.arctanh(","arsech(":"C.arcsech(","arcsch(":"C.arccsch(","arcoth(":"C.arccoth(","acosh(":"C.arccosh(","asinh(":"C.arcsinh(","atanh(":"C.arctanh(","asech(":"C.arcsech(","acsch(":"C.arccsch(","acoth(":"C.arccoth(","exp(":"C.exp("},o={"+":".add(","-":".sub(","*":".mult("," ":".mult(","/":".divBy(","^":".cPow(","%":".mod("},u={e:"C.E",i:"C.I",pi:"C.PI"},a=function(t){var n=/\{|\[/,r=/\}|\]/,i=/\d[a-z\{\[\(]|[\}\]\)][a-z\d]/i,s=/^\de(?:-|)\d+/i,o=/[\+\-\*\/\^%]/;return t.replace(e,function u(a,f){if(i.test(a)){if(s.test(t.slice(f)))return a;return a.charAt(0).replace(e,u)+"*"+a.charAt(1).replace(e,u)}else if(n.test(a)){return"("}else if(r.test(a)){return")"}else{var l=a.search(o);return a.charAt(l!=-1?l:"*")}})},f=function(e){var t=/[^a-z]+/i;e=e.map(function(e){var n=e.replace(t,"");if(!n)throw'"'+e+'" is an invalid variable name. Only "a" through "z" are accepted within names. "e", "i" and "pi", will be calculated as the constants.';return n.toLowerCase()});var n="abcdefghijklmnopqrstuvwxyz",r=n.length,i={},s="",o,u;for(var a=0;a<e.length;a++){o=a;while(o>=0){u=o%r;o=o-u;s=n.charAt(u)+s;o=o/r-1}i[e[a]]=s;s=""}return i},l=function(e,t){var n=1;while(e[t]=="("?n++:e[t]==")"?--n:t<e.length)t++;return t},c=function(e,t){var n=0;for(var r=t;r<e.length;r++){if(e[r]=="(")n++;else if(e[r]==")")n--;if(n<0)return r;else if(n==0){if(e[r]=="+"||e[r]=="-"&&!o[e[r-1]])return r}}return e.length},h=function(e,t){var n=0;for(var r=t;r<e.length;r++){if(e[r]=="(")n++;else if(e[r]==")")n--;if(n<0)return r;else if(n==0){if(e[r]=="+"||e[r]=="-"&&!o[e[r-1]])return r;if(e[r]=="*"||e[r]=="/"||e[r]==" "||e[r]=="%")return r}}return e.length},p=function(e,t){var n=0;for(var r=t;r<e.length;r++){if(e[r]=="(")n++;else if(e[r]==")")n--;if(n<0)return r;else if(n==0){if(e[r]=="+"||e[r]=="-"&&e[r-1]!="^")return r;if(e[r]=="*"||e[r]=="/"||e[r]==" "||e[r]=="%")return r;if(e[r]=="^")return r}}return e.length},d=function(e,t,n){switch(e){case"+":case"-":return c(t,n);case"*":case"/":case" ":case"%":return h(t,n);case"^":return p(t,n);default:throw'"'+e+'" is not a valid operator.'}},v=function(){var e=this;e.array=[];e.addC=function(t){e.array.push(t);return e.array.length-1}};C.formatFunction=a;return{funcExp:t,varsExp:n,operExp:r,numsExp:i,funcObj:s,varsObj:u,operObj:o,generate:f,formatFunction:a,endNest:l,nextAddSub:c,nextMultDiv:h,nextPower:p,nextOperator:d,Namespace:v}}());C["0"]=C(0,0,0,0);C["1"]=C(1,0,1,0);C["I"]=C(0,1,1,PI/2);C["-I"]=C(0,-1,1,3*PI/2);C["PI"]=C(PI,0,PI,0);C["E"]=C(Math.E,0,Math.E,0);C["2"]=C(2,0,2,0);C["2I"]=C(0,2,2,PI/2);if(typeof module!=="undefined"&&module.exports)module.exports=C;else root.Complex=C})(this)